<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Voucher - {{ booking.booking_reference }}</title>
    <style>
        @page {
            size: A4;
            margin: 8mm 15mm 15mm 15mm;

            @bottom-center {
                content: "Dhakul Chan Travel Service   System DCT        <!-- Guest Names Section -->
 <div class="section-header">Guest Name(s) :</div><div class="section-content guest-content"> {
                    % set processed_guests=booking.get_guest_list() %
                }

                    {
                    % if processed_guests %
                }

                    {
                    % if processed_guests is string %
                }

                    {
                        {
                        processed_guests | replace('\n', '<br>') | safe
                    }
                }

                    {
                    % elif processed_guests is iterable %
                }

                    {
                    % for guest in processed_guests %
                }

                    {
                        {
                        guest | replace('\n', '<br>') | safe
                    }
                }

                    {
                    % if not loop.last %
                }

                <br> {
                    % endif %
                }

                    {
                    % endfor %
                }

                    {
                    % else %
                }

                    {
                        {
                        processed_guests | replace('\n', '<br>') | safe
                    }
                }

                    {
                    % endif %
                }

                    {
                    % else %
                }

                No guest information available {
                    % endif %
                }

                </div>< !-- Service Detail Section --><div class="section-header">Service Detail / Itinerary :</div><div class="section-content" style="white-space: pre-wrap;"> {
                        {
                        booking.description or booking.internal_note or 'SSSSSSS'
                    }
                }

                </div>< !-- Flight Information Section --><div class="section-header">Flight Information :</div><div class="section-content flight-content"> {
                    % set flight_info=booking.flight_info %
                }

                    {
                    % if flight_info and flight_info !='FFFFFF' %
                }

                    {
                        {
                        flight_info | replace('\n', '<br>') | safe
                    }
                }

                    {
                    % else %
                }

                No flight information available {
                    % endif %
                }

                </div>< !-- Voucher Images Display -->ter(page) " of " counter(pages);
                font-size: 9px;
                color: #666;
            }
        }

        @page :not(:first) {
            @top-left {
                content: "DHAKUL CHAN NICE HOLIDAYS DISCOVERY GROUP COMPANY LIMITED.";
                font-size: 10px;
                font-weight: bold;
                margin-bottom: 5px;
                padding-top: 5mm;
            }

            @top-center {
                content: "Flat C19, 21/F, Mai Yah Industrial Bldg., No. 1-7 Wan Shing Street, Kwai Chung, N.T. Hong Kong Tel: +852 2392 1155 | Mobile: +852 2392 1177";
                font-size: 8px;
                padding-top: 5mm;
            }

            @top-right {
                content: url("static/images/dcts-logo-vou.png");
                width: 50px;
                height: auto;
                padding-top: 5mm;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Thai', Arial, sans-serif;
            font-size: 11px;
            line-height: 1.3;
            color: #000;
        }

        .voucher-container {
            width: 100%;
            padding: 0;
        }

        /* Header Section */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        .company-info {
            flex: 1;
        }

        .company-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .company-address {
            font-size: 9px;
            line-height: 1.2;
            color: #333;
        }

        .company-logo {
            width: 80px;
            height: auto;
            margin-left: 20px;
        }

        .company-logo img {
            width: 80px;
            height: auto;
            max-height: 60px;
            object-fit: contain;
        }

        /* Page Header for All Pages */
        .page-header {
            width: 100%;
            display: table;
            margin-bottom: 15px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
            page-break-inside: avoid;
        }

        .voucher-container {
            width: 100%;
            padding: 0;
        }

        .page-header .company-info {
            display: table-cell;
            vertical-align: top;
            width: 75%;
        }

        .page-header .company-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .page-header .company-address {
            font-size: 9px;
            line-height: 1.2;
            color: #333;
        }

        .page-header .company-logo {
            display: table-cell;
            vertical-align: top;
            width: 25%;
            text-align: right;
        }

        .page-header .company-logo img {
            width: 80px;
            height: auto;
            max-height: 60px;
        }

        /* Title Section */
        .title-section {
            text-align: center;
            margin: 20px 0 15px 0;
        }

        .main-title {
            font-size: 18px;
            font-weight: bold;
            text-decoration: underline;
            margin-bottom: 10px;
        }

        /* Booking Info Grid */
        .booking-info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 10px;
            line-height: 1.3;
        }

        .booking-info-table td {
            padding: 3px 8px 3px 0;
            vertical-align: top;
            border: none;
            width: 33.33%;
        }

        .info-label {
            font-weight: bold;
            display: inline;
            margin-right: 5px;
        }

        .info-value {
            display: inline;
        }

        /* Service Table */
        .service-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        .service-header {
            background-color: #4472C4;
            color: white;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
        }

        .service-table th,
        .service-table td {
            border: 1px solid #666;
            padding: 6px 4px;
            text-align: center;
            font-size: 10px;
        }

        /* Service table specific column alignments */
        .service-table td:nth-child(4) {
            text-align: left;
            /* Service By / Supplier column */
        }

        .service-table th {
            background-color: #E7E6E6;
            font-weight: bold;
        }

        /* Section Headers */
        .section-header {
            background-color: transparent;
            color: black;
            padding: 0px;
            margin: 12px 0px 0px 0px;
            font-weight: bold;
            font-size: 11px;
            border: none;
        }

        .section-content {
            border: none;
            padding: 0px;
            margin: 0px;
            min-height: auto;
            font-size: 10px;
            white-space: normal;
            background-color: transparent;
            text-indent: 0px;
        }

        /* Guest Names Content */
        .guest-content {
            line-height: 1.2 !important;
            white-space: normal;
            font-family: 'Noto Sans Thai', Arial, sans-serif;
            margin: 0px;
            padding: 0px;
            text-indent: 0px;
        }

        /* Flight Information Content */
        .flight-content {
            line-height: 1.2 !important;
            white-space: normal;
            font-family: 'Noto Sans Thai', Arial, sans-serif;
            margin: 0px;
            padding: 0px;
            text-indent: 0px;
        }

        /* Terms Section */
        .terms-section {
            margin: 15px 0;
        }

        .terms-content {
            font-size: 9px;
            line-height: 1.4;
        }

        .terms-content ul {
            margin-left: 15px;
        }

        .terms-content li {
            margin-bottom: 3px;
        }

        /* Signature Section */
        .signature-section {
            margin: 0;
            padding: 0;
        }

        .signature-label {
            font-weight: bold;
            margin-bottom: 30px;
            font-size: 11px;
        }

        .signature-line {
            border-top: 1px solid #000;
            margin: 0 15px;
        }

        .signature-details {
            font-size: 9px;
            margin-top: 4px;
        }

        /* Utilities */
        .text-center {
            text-align: center;
        }

        .font-bold {
            font-weight: bold;
        }

        .mb-5 {
            margin-bottom: 5px;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .mb-15 {
            margin-bottom: 15px;
        }

        /* Voucher Images Section */
        .voucher-images-section {
            margin: 15px 0;
            padding: 0;
            page-break-inside: avoid;
            width: 100%;
        }

        .voucher-images-container {
            display: block;
            text-align: center;
            width: 100%;
            border: none;
            padding: 0;
            background-color: transparent;
        }

        .voucher-image {
            width: 100%;
            max-width: 100%;
            height: auto;
            border: none;
            border-radius: 0;
            object-fit: contain;
            margin: 0 auto;
            display: block;
        }

        .voucher-image-item {
            display: block;
            margin: 12px 0;
            text-align: center;
            width: 100%;
        }

        .voucher-image-title {
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 5px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="voucher-container">
        <!-- Page Header for All Pages -->
        <div class="page-header">
            <div class="company-info">
                <div class="company-name">DHAKUL CHAN NICE HOLIDAYS DISCOVERY GROUP COMPANY LIMITED.</div>
                <div class="company-address">
                    Flat C19, 21/F, Mai Yah Industrial Bldg., No. 1-7 Wan Shing Street, Kwai Chung, N.T. Hong Kong<br>
                    Tel: +852 2392 1155 | Mobile: +852 2392 1177 | Email: info@dhakulchan.net | Website:
                    www.dhakulchan.net
                </div>
            </div>
            <div class="company-logo">
                <img src="static/images/dcts-logo-vou.png" alt="DCTS Logo">
            </div>
        </div>

        <!-- Title -->
        <div class="title-section">
            <div class="main-title">TOUR VOUCHER / SERVICE ORDER</div>
        </div>

        <!-- Booking Information Table -->
        <table class="booking-info-table">
            <tr>
                <td>
                    <span class="info-label">Quote Number:</span>
                    <span class="info-value">{{ booking.quote_number or 'QT1759448946' }}</span>
                </td>
                <td>
                    <span class="info-label">Booking Ref.:</span>
                    <span class="info-value">{{ booking.booking_reference or 'BK20251002NAJZ' }}</span>
                </td>
                <td>
                    <span class="info-label">Customer:</span>
                    <span class="info-value">{{ booking.get_customer_name_with_id() or 'PCCM YC' }}</span>
                    <span class="info-label"> | Total Pax:</span>
                    <span class="info-value">{{ booking.total_pax or '4' }}</span>
                </td>
            </tr>
            <tr>
                <td>
                    <span class="info-label">Party Name:</span>
                    <span class="info-value">{{ booking.party_name or 'PKG2502211' }}</span>
                </td>
                <td>
                    <span class="info-label">Arrival Date:</span>
                    <span class="info-value">{{ booking.traveling_period_start.strftime('%d/%m/%Y') if
                        booking.traveling_period_start else '22/09/2025' }}</span>
                </td>
                <td>
                    <span class="info-label">Departure Date:</span>
                    <span class="info-value">{{ booking.traveling_period_end.strftime('%d/%m/%Y') if
                        booking.traveling_period_end else '22/09/2025' }}</span>
                </td>
            </tr>
        </table>

        <!-- Service Table -->
        <div class="service-header">Hotel / Accommodation | Transfer | Others | Flight Detail</div>
        <table class="service-table">
            <thead>
                <tr>
                    <th style="width: 8%;">No.</th>
                    <th style="width: 18%;">Arrival</th>
                    <th style="width: 18%;">Departure</th>
                    <th style="width: 36%;">Service By / Supplier</th>
                    <th style="width: 20%;">Type/Class/Pax/Pieces</th>
                </tr>
            </thead>
            <tbody>
                {% set daily_services = booking.get_daily_services() %}
                {% if daily_services %}
                {% for service in daily_services %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ service.get('arrival', service.get('arrival_date', 'DD/MM/YYYY')) }}</td>
                    <td>{{ service.get('departure', service.get('departure_date', 'DD/MM/YYYY')) }}</td>
                    <td>{{ service.get('service_by', service.get('description', service.get('supplier_name', 'Service
                        Provider'))) }}</td>
                    <td>{{ service.get('type', service.get('service_type', service.get('room_type', 'Service'))) }}</td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td>1</td>
                    <td>{{ booking.traveling_period_start.strftime('%d/%m/%Y') if booking.traveling_period_start else
                        'DD/MM/YYYY' }}</td>
                    <td>{{ booking.traveling_period_end.strftime('%d/%m/%Y') if booking.traveling_period_end else
                        'DD/MM/YYYY' }}</td>
                    <td>{{ booking.description or booking.hotel_name or 'Hotel/Accommodation/Transfer' }}</td>
                    <td>{{ booking.room_type or 'Service Provider' }}</td>
                </tr>
                {% endif %}
            </tbody>
        </table>

        <!-- Guest Names Section -->
        <div class="section-header">Guest Name(s) :</div>
        <div class="section-content guest-content">
            {% set processed_guests = booking.get_guest_list() %}
            {% if processed_guests %}
            {% if processed_guests is string %}
            {{ processed_guests | replace('\n', '<br>') | safe }}
            {% elif processed_guests is iterable %}
            {% for guest in processed_guests %}{{ guest | replace('\n', '<br>') | safe }}{% if not loop.last %}<br>{%
            endif %}
            {% endfor %}
            {% else %}
            {{ processed_guests | replace('\n', '<br>') | safe }}
            {% endif %}
            {% else %}
            No guest information available
            {% endif %}
        </div>

        <!-- Service Detail Section -->
        <div class="section-header">Service Detail / Itinerary :</div>
        <div class="section-content" style="white-space: pre-wrap;">{{ booking.description or booking.internal_note or
            'SSSSSSS' }}</div>

        <!-- Flight Information Section -->
        <div class="section-header">Flight Information :</div>
        <div class="section-content flight-content">
            {% set flight_info = booking.flight_info %}
            {% if flight_info and flight_info != 'FFFFFF' %}
            {{ flight_info | replace('\n', '<br>') | safe }}
            {% else %}
            No flight information available
            {% endif %}
        </div>

        <!-- Voucher Images Display -->
        {% set voucher_images = booking.get_voucher_images() %}
        {% if voucher_images %}
        <div class="voucher-images-container" style="margin-top: 15px;">
            {% for image in voucher_images %}
            <div class="voucher-image-item">
                {% if image.original and image.original.title %}
                <div class="voucher-image-title">{{ image.original.title }}</div>
                {% elif image.title %}
                <div class="voucher-image-title">{{ image.title }}</div>
                {% endif %}
                <img src="{{ image.url }}" alt="Voucher Image" class="voucher-image">
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Terms and Conditions -->
        <div class="terms-section">
            <div style="font-weight: bold; margin-bottom: 8px;">Terms and Conditions</div>
            <div class="terms-content">
                <ul>
                    <li>This voucher is valid only for the dates and services mentioned above.</li>
                    <li>Please present this voucher at the time of service.</li>
                    <li>Any changes or cancellations must be made 24 hours in advance.</li>
                    <li>The company reserves the right to change services due to circumstances beyond our control.</li>
                </ul>
            </div>
        </div>

        <!-- Signature Section -->
        <div class="signature-section">
            <table style="width: 100%; border-collapse: collapse; margin: 20px 0 15px 0;">
                <tr>
                    <td style="width: 50%; text-align: center; vertical-align: top; padding: 15px 10px;">
                        <div class="signature-label">Authorized Signature</div>
                        <div class="signature-line"></div>
                        <div class="signature-details">
                            William / Tony (Operation Section)<br>
                            Date: {{ booking.created_at.strftime('%d/%m/%Y') if booking.created_at else '26/09/2025' }}
                            (DD/MM/YYYY)
                        </div>
                    </td>
                    <td style="width: 50%; text-align: center; vertical-align: top; padding: 15px 10px;">
                        <div class="signature-label">Guest Acknowledged</div>
                        <div class="signature-line"></div>
                        <div class="signature-details">
                            {{ booking.get_customer_name_with_id() }}
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</body>

</html>